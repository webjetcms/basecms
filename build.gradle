/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */

plugins {
    id 'java-library'
    id 'war'  
    id 'org.gretty' version "3.0.1"
    id "com.jfrog.artifactory" version "4.9.8"
    id 'idea'
}

repositories {
    jcenter()
    flatDir {
       dirs 'libs'
   }
}

war {
    zip64 = true
}

ext {
    webjetVersion = "8.7-SNAPSHOT";    
}

dependencies {

    compile("sk.iway:webjet:${webjetVersion}")
    compile("sk.iway:webjet:${webjetVersion}:admin")    
    compile("sk.iway:webjet:${webjetVersion}:components")
    compile("sk.iway:webjet:${webjetVersion}:struts")
    compile("sk.iway:webjet:${webjetVersion}:daisydiff")
    compile("sk.iway:webjet:${webjetVersion}:jtidy")
    compile("sk.iway:webjet:${webjetVersion}:swagger-ui")

    compile 'taglibs:standard:1.1.2'
    compile 'javax.servlet:jstl:1.2'

    providedCompile 'javax.servlet:javax.servlet-api:3.1.0' 
    providedCompile "javax.servlet:servlet-api:2.5"
    providedCompile "javax.servlet.jsp:javax.servlet.jsp-api:2.3.3"
    providedCompile 'javax.el:javax.el-api:3.0.0'
    providedCompile 'javax.annotation:jsr250-api:1.0'    
    providedCompile 'org.slf4j:slf4j-log4j12:1.7.25'

    testCompile 'junit:junit:4.12'
}

configurations { 
    all*.exclude group: 'org.slf4j', module: 'slf4j-over-slf4j' 
    all*.exclude group: 'org.slf4j', module: 'slf4j-log4j12'     

    //javax.xml.stream:stax-api:1.0-2 -> stax:stax-api:1.0.1
    all*.exclude group: 'javax.xml.stream', module: 'stax-api'

    grettyRunnerTomcat85 {
        exclude group: 'org.slf4j', module: 'log4j-over-slf4j'
    }
    grettyRunnerTomcat9 {
        exclude group: 'org.slf4j', module: 'log4j-over-slf4j'
    }
}

java {
    sourceCompatibility = JavaVersion.VERSION_1_8
    targetCompatibility = JavaVersion.VERSION_1_8
}

compileJava {
    options.incremental = true
    options.fork = true
    options.failOnError = true
    options.encoding = "windows-1250"
}

artifactory {
    contextUrl = "${artifactory_contextUrl}"
    resolve {
        repository {
            repoKey = 'gradle-dev'
            username = "${artifactory_user}"
            password = "${artifactory_password}"
            maven = true
        }
    }
}

gretty {
    // supported values:
    // 'jetty7', 'jetty8', 'jetty9', 'jetty9.3', 'jetty9.4', 'tomcat7', 'tomcat8'
    servletContainer = 'tomcat9'
    contextPath = ''  
    httpPort = 80
    //hard mod spusti WJ rovno z src/main/webapp co zrychli start (netreba kopirovat JSP subory niekde inde)
    inplaceMode = 'hard'
    //scanovania pre hotswap
    scanInterval = 1
    scanner = 'jdk'
    scanDir '${projectDir}/build/classes/java/main'
    fastReload = true
    managedClassReload = true
    //JVM parametre    
    jvmArgs = [
        //odporucane premenne pre Tomcat        
        '-Dsun.net.client.defaultConnectTimeout=300000',
        '-Dsun.net.client.defaultReadTimeout=300000',
        '-Dfile.encoding=utf-8',
        '-Duser.language=sk',
        '-Duser.country=SK',
        //povolenie remote debug na porte 5005
        '-Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005',
        //Uprava konfiguracie pre WebJET, tymto sa prepisuju hodnoty z databazy v Ovladaci panel->Konfiguracia
        '-Dwebjet.smtpServer=localhost'
    ]
}